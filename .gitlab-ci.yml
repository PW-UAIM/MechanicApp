stages:
    - build
    - test
    - docker
 #   - deploy

build_debug:
    stage: build
    before_script:
      - cd majumi.MechanicApp.BlazorServer
    script:
      - dotnet build -c Debug
    tags:
      - dotnet

build_release:
    stage: build
    before_script:
      - cd majumi.MechanicApp.BlazorServer
    script:
      - dotnet build -c Release
    tags:
      - dotnet  

unit_test:
    stage: test
    needs: [build_release, build_debug]
    before_script:
      - cd majumi.MechanicApp.Tests
    script:
      - dotnet test --filter ClassName="majumi.MechanicApp.Tests.UnitTests"
    tags:
      - dotnet


build_image:
    stage: docker
    needs: [unit_test]
    before_script:
      - cd Docker
    script:
      - ./BuildImage.bat
    tags:
      - docker

push_image:
    stage: docker
    needs: [build_image]
    before_script:
      - cd Docker
    script:
      - ./PushImage.bat
    tags:
      - docker

#production:
#    stage: deploy
#    needs: [push_image]
#    before_script:
#      - cd Kubernetes
#    script:
#      - Kubernetes_StopSystem.bat
#      - Kubernetes_StartSystem.bat
#    tags:
#      - kubernetes